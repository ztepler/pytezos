

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quick start &mdash; PyTezos  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  
    <link rel="canonical" href="https://pytezos.org/quick_start.html" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Michelson integration tests" href="integration_tests.html" />
    <link rel="prev" title="Welcome to PyTezos reference!" href="contents.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="contents.html" class="icon icon-home"> PyTezos
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-key-and-rpc-node">Set key and RPC node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#faucet-account">Faucet account</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sandboxed-mode">Sandboxed mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#activate-account">Activate account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reveal-public-key">Reveal public key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#originate-contract">Originate contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bulk-injecting">Bulk injecting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#call-an-entrypoint">Call an entrypoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-storage">Access storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bigmap-lookup">BigMap lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#view-method">View method</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration_tests.html">Michelson integration tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytezos_cli.html">PyTezos CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="high_level.html">High-level interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="crypto.html">Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_groups.html">Building and parsing operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc_queries.html">RPC query engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Michelson types</a></li>
<li class="toctree-l1"><a class="reference internal" href="instructions.html">Michelson instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Working with Michelson code</a></li>
<li class="toctree-l1"><a class="reference internal" href="repl.html">Michelson REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspect_proposals.html">Inspecting proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="michelson_kernel.html">Michelson IPython kernel</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="contents.html">PyTezos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="contents.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quick start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/quick_start.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quick-start">
<h1>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>PyTezos library is a Python toolset for Tezos blockchain, including work with keys, signatures, contracts, operations,
RPC query builder, and a high-level interface for smart contract interaction. It can be used to build a full-fledged
application, but also it’s perfect for doing researches in Jupyter interactive notebooks.
In this quick start guide, we’ll go through the main concepts and inspect one of the common use cases.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>First of all you’ll probably need to install cryptographic libraries in your system.</p>
<p><em>Linux</em></p>
<p>Use apt or your favourite package manager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt install libsodium-dev libsecp256k1-dev libgmp-dev
</pre></div>
</div>
<p><em>MacOS</em></p>
<p>Use homebrew:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ brew tap cuber/homebrew-libsecp256k1
$ brew install libsodium libsecp256k1 gmp
</pre></div>
</div>
<p><em>Windows</em></p>
<p>The recommended way is to use WSL and then follow the instructions for Linux,
but if you feel lucky you can try to install natively:</p>
<ol class="arabic simple">
<li><p>Install MinGW from <a class="reference external" href="https://osdn.net/projects/mingw/">https://osdn.net/projects/mingw/</a></p></li>
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">C:\MinGW\bin</span></code> is added to your <code class="docutils literal notranslate"><span class="pre">PATH</span></code></p></li>
<li><p>Download the latest libsodium-X.Y.Z-msvc.zip from <a class="reference external" href="https://download.libsodium.org/libsodium/releases/">https://download.libsodium.org/libsodium/releases/</a>.</p></li>
<li><p>Extract the Win64/Release/v143/dynamic/libsodium.dll from the zip file</p></li>
<li><p>Copy libsodium.dll to C:WindowsSystem32libsodium.dll</p></li>
</ol>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>In console:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install pytezos
</pre></div>
</div>
<p>In Google Colab notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; !apt install libsodium-dev libsecp256k1-dev libgmp-dev
&gt;&gt;&gt; !pip install pytezos
[RESTART RUNTIME]
</pre></div>
</div>
<p>That’s it! You can open Python console or Jupyter notebook and get to the next step.</p>
</div>
<div class="section" id="set-key-and-rpc-node">
<h2>Set key and RPC node<a class="headerlink" href="#set-key-and-rpc-node" title="Permalink to this headline">¶</a></h2>
<p>All active interaction with the blockchain starts with the PyTezosClient:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytezos</span> <span class="kn">import</span> <span class="n">pytezos</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span>
<span class="go">&lt;pytezos.client.PyTezosClient object at 0x7f480c03c190&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # tz1grSQDByRpnVs7sPtaprNZRp531ZKz6Jmm</span>
<span class="go"> .shell  # https://rpc.tzkt.io/edonet/ (edonet)</span>
<span class="go"> .block_id  # head</span>

<span class="go"> Helpers</span>
<span class="go"> .account()</span>
<span class="go"> .activate_account()</span>
<span class="go"> .balance()</span>
<span class="go"> .ballot()</span>
<span class="go"> .bulk()</span>
<span class="go"> .contract()</span>
<span class="go"> .delegation()</span>
<span class="go"> .double_baking_evidence()</span>
<span class="go"> .double_endorsement_evidence()</span>
<span class="go"> .endorsement()</span>
<span class="go"> .now()</span>
<span class="go"> .operation()</span>
<span class="go"> .operation_group()</span>
<span class="go"> .origination()</span>
<span class="go"> .proposals()</span>
<span class="go"> .reveal()</span>
<span class="go"> .seed_nonce_revelation()</span>
<span class="go"> .transaction()</span>
<span class="go"> .using()</span>
</pre></div>
</div>
<p>This is one of the cool features in the interactive mode: aside from the autocomplete and call docstrings,
you can see the list of available methods for class, or list of arguments and return value for a particular methods.
We are interested in <code class="docutils literal notranslate"><span class="pre">using</span></code> method, which is responsible for setting up manager key and RPC connection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">using</span>
<span class="go">&lt;function PyTezosClient.using at 0x7f47fc123550&gt;</span>
<span class="go"> Change current rpc endpoint and account (private key).</span>

<span class="go"> :param shell: one of &#39;mainnet&#39;, &#39;***net&#39;, or RPC node uri, or instance of :class:`pytezos.rpc.shell.ShellQuery`</span>
<span class="go"> :param key: base58 encoded key, path to the faucet file, alias from tezos-client, or instance of `Key`</span>
<span class="go"> :returns: A copy of current object with changes applied</span>
</pre></div>
</div>
<p>Note, that by default <code class="docutils literal notranslate"><span class="pre">pytezos</span></code> is initialized with the latest testnet and a predefined private key for demo purpose,
so you can start to interact immediately, but it’s highly recommended to use your own key. Let’s do that!</p>
<div class="section" id="faucet-account">
<h3>Faucet account<a class="headerlink" href="#faucet-account" title="Permalink to this headline">¶</a></h3>
<p>Go to the <a class="reference external" href="https://faucet.tzalpha.net/">https://faucet.tzalpha.net/</a> and download key file.
Then configure the client (we can leave <code class="docutils literal notranslate"><span class="pre">shell</span></code> parameter empty, but we will set it explicitly for better understanding)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;~/Downloads/tz1cnQZXoznhduu4MVWfJF6GSyP6mMHMbbWa.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="sandboxed-mode">
<h3>Sandboxed mode<a class="headerlink" href="#sandboxed-mode" title="Permalink to this headline">¶</a></h3>
<p>Accounts are pre-created in Sandboxed mode, this shows how to find the secret keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ grep SECRET src/bin_client/tezos-init-sandboxed-client.sh
export BOOTSTRAP1_SECRET=&quot;unencrypted:edsk3gUfUPyBSfrS9CCgmCiQsTCHGkviBDusMxDJstFtojtc1zcpsh&quot;
export BOOTSTRAP2_SECRET=&quot;unencrypted:edsk39qAm1fiMjgmPkw1EgQYkMzkJezLNewd7PLNHTkr6w9XA2zdfo&quot;
export BOOTSTRAP3_SECRET=&quot;unencrypted:edsk4ArLQgBTLWG5FJmnGnT689VKoqhXwmDPBuGx3z4cvwU9MmrPZZ&quot;
export BOOTSTRAP4_SECRET=&quot;unencrypted:edsk2uqQB9AY4FvioK2YMdfmyMrer5R8mGFyuaLLFfSRo8EoyNdht3&quot;
export BOOTSTRAP5_SECRET=&quot;unencrypted:edsk4QLrcijEffxV31gGdN2HU7UpyJjA8drFoNcmnB28n89YjPNRFm&quot;
export ACTIVATOR_SECRET=&quot;unencrypted:edsk31vznjHSSpGExDMHYASz45VZqXN4DPxvsa4hAyY8dHM28cZzp6&quot;
</pre></div>
</div>
<p>Use one of these unencrypted private keys to connect to the sandbox:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytezos</span> <span class="kn">import</span> <span class="n">pytezos</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">shell</span><span class="o">=</span><span class="s1">&#39;http://localhost:18731&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;edsk3gUfUPyBSfrS9CCgmCiQsTCHGkviBDusMxDJstFtojtc1zcpsh&#39;</span><span class="p">)</span>
<span class="go">&lt;pytezos.client.PyTezosClient object at 0x7f2c2d78da10&gt;</span>

<span class="go">Properties</span>
<span class="go">.key  # tz1KqTpEZ7Yob7QbPE4Hy4Wo8fHG8LhKxZSx</span>
<span class="go">.shell  # http://localhost:18731 ()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="activate-account">
<h2>Activate account<a class="headerlink" href="#activate-account" title="Permalink to this headline">¶</a></h2>
<p>In order to start using our faucet account we need to claim balance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">activate_account</span>
<span class="go">&lt;function ContentMixin.activate_account at 0x7f6f555e5400&gt;</span>

<span class="go">Activate recommended allocations for contributions to the TF fundraiser.</span>
<span class="go">More info https://activate.tezos.com/</span>
<span class="go">:param pkh: Public key hash, leave empty for autocomplete</span>
<span class="go">:param activation_code: Secret code from pdf, leave empty for autocomplete</span>
<span class="go">:return: dict or OperationGroup</span>
</pre></div>
</div>
<p>Cool! We can just leave all fields empty and let PyTezos do all the work. There are two autocomplete function available:
<code class="docutils literal notranslate"><span class="pre">fill</span></code> and <code class="docutils literal notranslate"><span class="pre">autofill</span></code>. The only difference is that <code class="docutils literal notranslate"><span class="pre">autofill</span></code> simulates the operation and sets precise values for fee
and gas/storage limits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">activate_account</span><span class="p">()</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span>
<span class="go">&lt;pytezos.operation.group.OperationGroup object at 0x7f291b7074e0&gt;</span>

<span class="go">Properties</span>
<span class="go">.key  # tz1cnQZXoznhduu4MVWfJF6GSyP6mMHMbbWa</span>
<span class="go">.shell  # https://rpc.tzkt.io/edonet/ (edonet)</span>

<span class="go">Payload</span>
<span class="go">{&#39;branch&#39;: &#39;BMNPpkcU6jzdaZC6AvtyVZzPkWLHFsyadCzDPQNxPDG8YUX8EyR&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;activate_account&#39;,</span>
<span class="go">               &#39;pkh&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">               &#39;secret&#39;: &#39;ac4aab725c5f5c9323155778e9dec94a14df09eb&#39;}],</span>
<span class="go"> &#39;protocol&#39;: &#39;PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq&#39;,</span>
<span class="go"> &#39;signature&#39;: None}</span>

<span class="go">Helpers</span>
<span class="go">.activate_account()</span>
<span class="go">.autofill()</span>
<span class="go">.ballot()</span>
<span class="go">.binary_payload()</span>
<span class="go">.delegation()</span>
<span class="go">.double_baking_evidence()</span>
<span class="go">.double_endorsement_evidence()</span>
<span class="go">.endorsement()</span>
<span class="go">.fill()</span>
<span class="go">.forge()</span>
<span class="go">.hash()</span>
<span class="go">.inject()</span>
<span class="go">.json_payload()</span>
<span class="go">.operation()</span>
<span class="go">.origination()</span>
<span class="go">.preapply()</span>
<span class="go">.proposals()</span>
<span class="go">.reveal()</span>
<span class="go">.run()</span>
<span class="go">.seed_nonce_revelation()</span>
<span class="go">.sign()</span>
<span class="go">.transaction()</span>
<span class="go">.using()</span>
</pre></div>
</div>
<p>Have you noticed that operation helpers are still available? We can easily chain operations but we cannot for example
put <code class="docutils literal notranslate"><span class="pre">activate_account</span></code> and <code class="docutils literal notranslate"><span class="pre">reveal</span></code> together because they are from different validation passes.
Ok, let’s sign and preapply operation to see what’s going to happen:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">activate_account</span><span class="p">()</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">preapply</span><span class="p">()</span>
<span class="go">[{&#39;contents&#39;: [{&#39;kind&#39;: &#39;activate_account&#39;,</span>
<span class="go">    &#39;pkh&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">    &#39;secret&#39;: &#39;ac4aab725c5f5c9323155778e9dec94a14df09eb&#39;,</span>
<span class="go">    &#39;metadata&#39;: {&#39;balance_updates&#39;: [{&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">       &#39;contract&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">       &#39;change&#39;: &#39;10848740286&#39;}]}}],</span>
<span class="go">  &#39;signature&#39;: &#39;sigUbev7tsZbMXXJ6QWE12ukaJ9F6fQ9Gzxku2iDTv7j4ipRgxhS4g9P9hV39Fb1xGir1PYXNQt1y6qydGbRUgjAXWmzVjA4&#39;}]</span>
</pre></div>
</div>
<p>Everything looks good! Ready to inject the operation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">activate_account</span><span class="p">()</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">inject</span><span class="p">()</span>
<span class="go">{&#39;chain_id&#39;: &#39;NetXSp4gfdanies&#39;,</span>
<span class="go"> &#39;hash&#39;: &#39;ooTAsux9JZVh1ud2euNrFBFDxUCxWYg3d1tWZSa7WLavVs1wMc9&#39;,</span>
<span class="go"> &#39;protocol&#39;: &#39;PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq&#39;,</span>
<span class="go"> &#39;branch&#39;: &#39;BMNPpkcU6jzdaZC6AvtyVZzPkWLHFsyadCzDPQNxPDG8YUX8EyR&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;activate_account&#39;,</span>
<span class="go">   &#39;pkh&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">   &#39;secret&#39;: &#39;ac4aab725c5f5c9323155778e9dec94a14df09eb&#39;}],</span>
<span class="go"> &#39;signature&#39;: &#39;sigUbev7tsZbMXXJ6QWE12ukaJ9F6fQ9Gzxku2iDTv7j4ipRgxhS4g9P9hV39Fb1xGir1PYXNQt1y6qydGbRUgjAXWmzVjA4&#39;}</span>
</pre></div>
</div>
<p>We can search our operation in the node mempool to check what status it has:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">mempool</span><span class="o">.</span><span class="n">pending_operations</span><span class="p">[</span><span class="s1">&#39;ooTAsux9JZVh1ud2euNrFBFDxUCxWYg3d1tWZSa7WLavVs1wMc9&#39;</span><span class="p">]</span>
<span class="go">{&#39;status&#39;: &#39;applied&#39;,</span>
<span class="go"> &#39;hash&#39;: &#39;ooTAsux9JZVh1ud2euNrFBFDxUCxWYg3d1tWZSa7WLavVs1wMc9&#39;,</span>
<span class="go"> &#39;branch&#39;: &#39;BMNPpkcU6jzdaZC6AvtyVZzPkWLHFsyadCzDPQNxPDG8YUX8EyR&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;activate_account&#39;,</span>
<span class="go">   &#39;pkh&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">   &#39;secret&#39;: &#39;ac4aab725c5f5c9323155778e9dec94a14df09eb&#39;}],</span>
<span class="go"> &#39;signature&#39;: &#39;sigUbev7tsZbMXXJ6QWE12ukaJ9F6fQ9Gzxku2iDTv7j4ipRgxhS4g9P9hV39Fb1xGir1PYXNQt1y6qydGbRUgjAXWmzVjA4&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">account</span><span class="p">()</span>
<span class="go">{&#39;balance&#39;: &#39;42119864414&#39;, &#39;counter&#39;: &#39;286565&#39;}</span>
</pre></div>
</div>
<p>Yay! We have claimed our account balance.</p>
</div>
<div class="section" id="reveal-public-key">
<h2>Reveal public key<a class="headerlink" href="#reveal-public-key" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">reveal</span><span class="p">()</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">inject</span><span class="p">()</span>
<span class="go">{&#39;chain_id&#39;: &#39;NetXSp4gfdanies&#39;,</span>
<span class="go"> &#39;hash&#39;: &#39;opMnhvsnccU9ZRZc6gaF1WgLNnBkJW7G7j4RX1eKWLkiWSSXf2S&#39;,</span>
<span class="go"> &#39;protocol&#39;: &#39;PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq&#39;,</span>
<span class="go"> &#39;branch&#39;: &#39;BMbaFNPvFYAUaY74YXtweKuv6khEiwEyFfggCUDawNLv6yTc8LP&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;reveal&#39;,</span>
<span class="go">   &#39;source&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">   &#39;fee&#39;: &#39;380&#39;,</span>
<span class="go">   &#39;counter&#39;: &#39;286566&#39;,</span>
<span class="go">   &#39;gas_limit&#39;: &#39;1200&#39;,</span>
<span class="go">   &#39;storage_limit&#39;: &#39;0&#39;,</span>
<span class="go">   &#39;public_key&#39;: &#39;edpkvRPjGLLi8fHKuoffMni4Nqrq6YVYd5zGUCvHD4aoKkU2ZtGR6M&#39;}],</span>
<span class="go"> &#39;signature&#39;: &#39;sigY7LffHKu7pnXsWTkqodYY2weG527zDKZgxnF5E7uhEQRpXyHsfT4T5kH33HRBD2z7tVGVyagP2ahoSvVb8pjnoyAqJUpZ&#39;}</span>
</pre></div>
</div>
<p>We can also search for operation by hash if we know exact block level or that it was injected recently:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">find_operation</span><span class="p">(</span><span class="s1">&#39;opMnhvsnccU9ZRZc6gaF1WgLNnBkJW7G7j4RX1eKWLkiWSSXf2S&#39;</span><span class="p">)</span>
<span class="go">{&#39;protocol&#39;: &#39;PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq&#39;,</span>
<span class="go"> &#39;chain_id&#39;: &#39;NetXSp4gfdanies&#39;,</span>
<span class="go"> &#39;hash&#39;: &#39;opMnhvsnccU9ZRZc6gaF1WgLNnBkJW7G7j4RX1eKWLkiWSSXf2S&#39;,</span>
<span class="go"> &#39;branch&#39;: &#39;BMbaFNPvFYAUaY74YXtweKuv6khEiwEyFfggCUDawNLv6yTc8LP&#39;,</span>
<span class="go"> &#39;contents&#39;: [{&#39;kind&#39;: &#39;reveal&#39;,</span>
<span class="go">   &#39;source&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">   &#39;fee&#39;: &#39;380&#39;,</span>
<span class="go">   &#39;counter&#39;: &#39;286566&#39;,</span>
<span class="go">   &#39;gas_limit&#39;: &#39;1200&#39;,</span>
<span class="go">   &#39;storage_limit&#39;: &#39;0&#39;,</span>
<span class="go">   &#39;public_key&#39;: &#39;edpkvRPjGLLi8fHKuoffMni4Nqrq6YVYd5zGUCvHD4aoKkU2ZtGR6M&#39;,</span>
<span class="go">   &#39;metadata&#39;: {&#39;balance_updates&#39;: [{&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">      &#39;contract&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">      &#39;change&#39;: &#39;-380&#39;},</span>
<span class="go">     {&#39;kind&#39;: &#39;freezer&#39;,</span>
<span class="go">      &#39;category&#39;: &#39;fees&#39;,</span>
<span class="go">      &#39;delegate&#39;: &#39;tz1VpvtSaSxKvykrqajFJTZqCXgoVJ5cKaM1&#39;,</span>
<span class="go">      &#39;cycle&#39;: 101,</span>
<span class="go">      &#39;change&#39;: &#39;380&#39;}],</span>
<span class="go">    &#39;operation_result&#39;: {&#39;status&#39;: &#39;applied&#39;,</span>
<span class="go">     &#39;consumed_gas&#39;: &#39;1000&#39;,</span>
<span class="go">     &#39;consumed_milligas&#39;: &#39;1000000&#39;}}}],</span>
<span class="go"> &#39;signature&#39;: &#39;sigY7LffHKu7pnXsWTkqodYY2weG527zDKZgxnF5E7uhEQRpXyHsfT4T5kH33HRBD2z7tVGVyagP2ahoSvVb8pjnoyAqJUpZ&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="originate-contract">
<h2>Originate contract<a class="headerlink" href="#originate-contract" title="Permalink to this headline">¶</a></h2>
<p>Now we can do something interesting. Let’s deploy a Michelson smart contract! First we need to load data, in this
tutorial we will get it from Michelson source file. There are plenty of available methods, but we’are interested in
<code class="docutils literal notranslate"><span class="pre">script</span></code> which gives us payload for origination.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytezos</span> <span class="kn">import</span> <span class="n">ContractInterface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">=</span> <span class="n">ContractInterface</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://gitlab.com/tezos/tezos/-/raw/master/tests_python/contracts_008/mini_scenarios/ticket_wallet_fungible.tz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span><span class="o">.</span><span class="n">script</span>
<span class="go">&lt;function ContractInterface.script at 0x7fc1768e2c10&gt;</span>
<span class="go">Generate script for contract origination.</span>

<span class="go">:param initial_storage: Python object, leave None to generate default (attach shell/key for smart fill)</span>
<span class="go">:param mode: whether to use `readable` or `optimized` (or `legacy_optimized`) encoding for initial storage</span>
<span class="go">:return: {&quot;code&quot;: $Micheline, &quot;storage&quot;: $Micheline}</span>
</pre></div>
</div>
<p>PyTezos can generate empty storage based on the type description, moreover it can do smart filling with the context provided (network, key).
Let’s attach shell and key to the contract interface and see the default storage generated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ci</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;edsk4CsgT5yQSxXGvU1uXMNNcoMLXGSQ99GRh72j6sQyNKgSnkmzTT&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="n">ci</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">dummy</span><span class="p">()</span>
<span class="go">{&#39;manager&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;, &#39;tickets&#39;: {}}</span>
</pre></div>
</div>
<p>Perfect! Now we are ready to deploy the contract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pytezos</span><span class="o">.</span><span class="n">origination</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="n">ci</span><span class="o">.</span><span class="n">script</span><span class="p">())</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">_async</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">Wait 22 seconds until block BLTpvkYfrBkpJYed91XXEQHatQ3RMqSmvRLUEyG5kCQyQNvQiW5 is finalized</span>
<span class="go">{&#39;protocol&#39;: &#39;PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA&#39;,</span>
<span class="go">  &#39;chain_id&#39;: &#39;NetXSgo1ZT2DRUG&#39;,</span>
<span class="go">  &#39;hash&#39;: &#39;ooKx4wBV4DerrXnAEMRfZrwTyBZQQgBMGGD3xbyXeffWn88QC1f&#39;,</span>
<span class="go">  &#39;branch&#39;: &#39;BM8tcfVyd1g8yqqfE8UpasXZWFLS3Xr3cRyYaoKTTfhU9PUr1YR&#39;,</span>
<span class="go">  &#39;contents&#39;: [{&#39;kind&#39;: &#39;origination&#39;,</span>
<span class="go">    &#39;source&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">    &#39;fee&#39;: &#39;1388&#39;,</span>
<span class="go">    &#39;counter&#39;: &#39;286567&#39;,</span>
<span class="go">    &#39;gas_limit&#39;: &#39;4377&#39;,</span>
<span class="go">    &#39;storage_limit&#39;: &#39;993&#39;,</span>
<span class="go">    &#39;balance&#39;: &#39;0&#39;,</span>
<span class="go">    &#39;script&#39;: {&#39;code&#39;: [...],</span>
<span class="go">     &#39;storage&#39;: {&#39;prim&#39;: &#39;Pair&#39;,</span>
<span class="go">      &#39;args&#39;: [{&#39;string&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;}, []]}},</span>
<span class="go">    &#39;metadata&#39;: {&#39;balance_updates&#39;: [{&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">       &#39;contract&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">       &#39;change&#39;: &#39;-1388&#39;},</span>
<span class="go">      {&#39;kind&#39;: &#39;freezer&#39;,</span>
<span class="go">       &#39;category&#39;: &#39;fees&#39;,</span>
<span class="go">       &#39;delegate&#39;: &#39;tz1aXQtpS22TKdqxsvFXo9pi5KDbQeyryzLH&#39;,</span>
<span class="go">       &#39;cycle&#39;: 101,</span>
<span class="go">       &#39;change&#39;: &#39;1388&#39;}],</span>
<span class="go">     &#39;operation_result&#39;: {&#39;status&#39;: &#39;applied&#39;,</span>
<span class="go">      &#39;big_map_diff&#39;: [{&#39;action&#39;: &#39;alloc&#39;,</span>
<span class="go">        &#39;big_map&#39;: &#39;8458&#39;,</span>
<span class="go">        &#39;key_type&#39;: {&#39;prim&#39;: &#39;address&#39;},</span>
<span class="go">        &#39;value_type&#39;: {&#39;prim&#39;: &#39;ticket&#39;, &#39;args&#39;: [{&#39;prim&#39;: &#39;unit&#39;}]}}],</span>
<span class="go">      &#39;balance_updates&#39;: [{&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">        &#39;contract&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">        &#39;change&#39;: &#39;-184000&#39;},</span>
<span class="go">       {&#39;kind&#39;: &#39;contract&#39;,</span>
<span class="go">        &#39;contract&#39;: &#39;tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB&#39;,</span>
<span class="go">        &#39;change&#39;: &#39;-64250&#39;}],</span>
<span class="go">      &#39;originated_contracts&#39;: [&#39;KT1CPe5vfXDzozzVXwGUESfisWgjin7MauLz&#39;],</span>
<span class="go">      &#39;consumed_gas&#39;: &#39;4177&#39;,</span>
<span class="go">      &#39;consumed_milligas&#39;: &#39;4176862&#39;,</span>
<span class="go">      &#39;storage_size&#39;: &#39;736&#39;,</span>
<span class="go">      &#39;paid_storage_size_diff&#39;: &#39;736&#39;,</span>
<span class="go">      &#39;lazy_storage_diff&#39;: [{&#39;kind&#39;: &#39;big_map&#39;,</span>
<span class="go">        &#39;id&#39;: &#39;8458&#39;,</span>
<span class="go">        &#39;diff&#39;: {&#39;action&#39;: &#39;alloc&#39;,</span>
<span class="go">         &#39;updates&#39;: [],</span>
<span class="go">         &#39;key_type&#39;: {&#39;prim&#39;: &#39;address&#39;},</span>
<span class="go">         &#39;value_type&#39;: {&#39;prim&#39;: &#39;ticket&#39;, &#39;args&#39;: [{&#39;prim&#39;: &#39;unit&#39;}]}}}]}}}],</span>
<span class="go">  &#39;signature&#39;: &#39;sigUZzbKEGvHrDLaLV68pRYjbKDUPJXzWLrApDvkSUQw28DTkNMSkAejxJTfcy6DZG7EayHaEzNnihUVYsb57GYggchzbrqe&#39;}</span>
</pre></div>
</div>
<p>Note that we used asynchronous injection this time, PyTezos does all the polling job for you and freezes the execution until operations is included into a block.
Previously we were searching operation using an integer ofsset (N levels ago), here’s another example how to search an operation using branch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pytezos.operation.result</span> <span class="kn">import</span> <span class="n">OperationResult</span>
<span class="gp">... </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="s1">&#39;BM8tcfVyd1g8yqqfE8UpasXZWFLS3Xr3cRyYaoKTTfhU9PUr1YR&#39;</span><span class="p">:]</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">find_operation</span><span class="p">(</span><span class="s1">&#39;ooKx4wBV4DerrXnAEMRfZrwTyBZQQgBMGGD3xbyXeffWn88QC1f&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="n">res</span> <span class="o">=</span> <span class="n">OperationResult</span><span class="o">.</span><span class="n">from_operation_group</span><span class="p">(</span><span class="n">opg</span><span class="p">)</span>
<span class="gp">... </span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">originated_contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&#39;KT1GmhxDtFRdcFdC8G8Wo2B8wXaP76eRYgDc&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="bulk-injecting">
<h2>Bulk injecting<a class="headerlink" href="#bulk-injecting" title="Permalink to this headline">¶</a></h2>
<p>The example we chose is actually a ticket wallet that can only send or receive existing tickets, so we need another contract capable of minting new ones.
Simultaneously, we will explore how to batch several operations in a single group.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span> <span class="o">=</span> <span class="n">ContractInterface</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://gitlab.com/tezos/tezos/-/raw/master/tests_python/contracts_008/mini_scenarios/ticket_wallet_fungible.tz&#39;</span><span class="p">)</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;edsk4CsgT5yQSxXGvU1uXMNNcoMLXGSQ99GRh72j6sQyNKgSnkmzTT&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">builder</span> <span class="o">=</span> <span class="n">ContractInterface</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s1">&#39;https://gitlab.com/tezos/tezos/-/raw/master/tests_python/contracts_008/mini_scenarios/ticket_builder_fungible.tz&#39;</span><span class="p">)</span> \
<span class="gp">... </span>    <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;edsk4CsgT5yQSxXGvU1uXMNNcoMLXGSQ99GRh72j6sQyNKgSnkmzTT&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">wallet</span><span class="o">.</span><span class="n">originate</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">builder</span><span class="o">.</span><span class="n">originate</span><span class="p">()</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">_async</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">originated_contracts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">OperationResult</span><span class="o">.</span><span class="n">from_operation_group</span><span class="p">(</span><span class="n">opg</span><span class="p">)]</span>
<span class="go">[&#39;KT1H4x2tanAMtKW94HrCbpA9nRssfXX7LRj8&#39;, &#39;KT1ENowZcfjAwYPSresbMBHnLMUhhuACWL7X&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="call-an-entrypoint">
<h2>Call an entrypoint<a class="headerlink" href="#call-an-entrypoint" title="Permalink to this headline">¶</a></h2>
<p>We have our contracts deployed and ready to be invoked, let’s see the list of entrypoints available and their signatures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">builder</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1ENowZcfjAwYPSresbMBHnLMUhhuACWL7X&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="n">builder</span><span class="o">.</span><span class="n">parameter</span>
<span class="go"> &lt;pytezos.contract.entrypoint.ContractEntrypoint object at 0x7f2a900c2b80&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB</span>
<span class="go"> .shell  # https://rpc.tzkt.io/edo2net/ (edo2net)</span>
<span class="go"> .address  # KT1ENowZcfjAwYPSresbMBHnLMUhhuACWL7X</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .entrypoint  # default</span>

<span class="go"> Builtin</span>
<span class="go"> (*args, **kwargs)  # build transaction parameters (see typedef)</span>

<span class="go"> Typedef</span>
<span class="go"> $default:</span>
<span class="go">     { &quot;burn&quot;: ticket (unit) } ||</span>
<span class="go">     { &quot;mint&quot;: $mint }</span>

<span class="go"> $mint:</span>
<span class="go">     {</span>
<span class="go">       &quot;destination&quot;: contract ($destination_param),</span>
<span class="go">       &quot;amount&quot;: nat</span>
<span class="go">     }</span>

<span class="go"> $destination_param:</span>
<span class="go">     ticket unit</span>

<span class="go"> $ticket:</span>
<span class="go">     /* no literal form, tickets can only be created by another contract */</span>

<span class="go"> $contract:</span>
<span class="go">     str  /* Base58 encoded `KT` address with optional entrypoint */ ||</span>
<span class="go">     None  /* when you need to avoid type checking */ ||</span>
<span class="go">     Undefined  /* `from pytezos import Undefined` for resolving None ambiguity  */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .encode()</span>
</pre></div>
</div>
<p>And for the wallet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1H4x2tanAMtKW94HrCbpA9nRssfXX7LRj8&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span><span class="o">.</span><span class="n">parameter</span>
<span class="go">&lt;pytezos.contract.entrypoint.ContractEntrypoint object at 0x7f2a82eaabb0&gt;</span>

<span class="go">Properties</span>
<span class="go">.key  # tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB</span>
<span class="go">.shell  # https://rpc.tzkt.io/edo2net/ (edo2net)</span>
<span class="go">.address  # KT1H4x2tanAMtKW94HrCbpA9nRssfXX7LRj8</span>
<span class="go">.block_id  # head</span>
<span class="go">.entrypoint  # default</span>

<span class="go">Builtin</span>
<span class="go">(*args, **kwargs)  # build transaction parameters (see typedef)</span>

<span class="go">Typedef</span>
<span class="go">$default:</span>
<span class="go">    { &quot;receive&quot;: ticket (unit) } ||</span>
<span class="go">    { &quot;send&quot;: $send }</span>

<span class="go">$send:</span>
<span class="go">    {</span>
<span class="go">      &quot;destination&quot;: contract ($destination_param),</span>
<span class="go">      &quot;amount&quot;: nat,</span>
<span class="go">      &quot;ticketer&quot;: address</span>
<span class="go">    }</span>

<span class="go">$destination_param:</span>
<span class="go">    ticket unit</span>

<span class="go">$ticket:</span>
<span class="go">    /* no literal form, tickets can only be created by another contract */</span>

<span class="go">$contract:</span>
<span class="go">    str  /* Base58 encoded `KT` address with optional entrypoint */ ||</span>
<span class="go">    None  /* when you need to avoid type checking */ ||</span>
<span class="go">    Undefined  /* `from pytezos import Undefined` for resolving None ambiguity  */</span>

<span class="go">$nat:</span>
<span class="go">    int  /* Natural number */</span>

<span class="go">$address:</span>
<span class="go">    str  /* Base58 encoded `tz` or `KT` address */</span>


<span class="go">Helpers</span>
<span class="go">.decode()</span>
<span class="go">.encode()</span>
</pre></div>
</div>
<p>Seems that we can mint a ticket using our builder and specify our wallet as a destination.
Let’s also use bulk API again to demonstrate how to batch contract calls:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">opg</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span>
<span class="gp">... </span>   <span class="n">builder</span><span class="o">.</span><span class="n">mint</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wallet</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s1">%receive&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="gp">... </span>   <span class="n">builder</span><span class="o">.</span><span class="n">mint</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wallet</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s1">%receive&#39;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">autofill</span><span class="p">()</span><span class="o">.</span><span class="n">sign</span><span class="p">()</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">_async</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">Wait 9 seconds until block BLQGB2tXQkUCZaU4dbG8vJEynkSsidL8YWcKQfnj9WZoJL69fb3 is finalized</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wallet</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;tickets&#39;</span><span class="p">][</span><span class="s1">&#39;KT1ENowZcfjAwYPSresbMBHnLMUhhuACWL7X&#39;</span><span class="p">]()</span>
<span class="go">(&#39;KT1ENowZcfjAwYPSresbMBHnLMUhhuACWL7X&#39;, Unit, 165)</span>
</pre></div>
</div>
<p>Success!</p>
</div>
<div class="section" id="access-storage">
<h2>Access storage<a class="headerlink" href="#access-storage" title="Permalink to this headline">¶</a></h2>
<p>We have slightly touched storage access in the previous section, now let’s play with <a class="reference external" href="https://better-call.dev/mainnet/KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf/operations">KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</a>
as it has BigMap entries, named entrypoints, and a non-trivial data scheme.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span> <span class="o">=</span> <span class="n">pytezos</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="s1">&#39;mainnet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="s1">&#39;KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span>
<span class="go"> &lt;pytezos.jupyter.ContractInterface object at 0x7fc17689f2b0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB</span>
<span class="go"> .shell  # https://mainnet-tezos.giganode.io/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .storage  # access storage data at block `block_id`</span>
<span class="go"> .parameter  # root entrypoint</span>

<span class="go"> Entrypoints</span>
<span class="go"> .accept_ownership()</span>
<span class="go"> .burn()</span>
<span class="go"> .call_FA2()</span>
<span class="go"> .balance_of()</span>
<span class="go"> .transfer()</span>
<span class="go"> .update_operators()</span>
<span class="go"> .change_master_minter()</span>
<span class="go"> .change_pauser()</span>
<span class="go"> .configure_minter()</span>
<span class="go"> .mint()</span>
<span class="go"> .pause()</span>
<span class="go"> .permit()</span>
<span class="go"> .remove_minter()</span>
<span class="go"> .set_expiry()</span>
<span class="go"> .set_transferlist()</span>
<span class="go"> .transfer_ownership()</span>
<span class="go"> .unpause()</span>
<span class="go"> .default()</span>

<span class="go"> Helpers</span>
<span class="go"> .big_map_get()</span>
<span class="go"> .create_from()</span>
<span class="go"> .from_context()</span>
<span class="go"> .from_file()</span>
<span class="go"> .from_micheline()</span>
<span class="go"> .from_michelson()</span>
<span class="go"> .operation_result()</span>
<span class="go"> .originate()</span>
<span class="go"> .program()</span>
<span class="go"> .script()</span>
<span class="go"> .to_file()</span>
<span class="go"> .to_micheline()</span>
<span class="go"> .to_michelson()</span>
<span class="go"> .using()</span>
</pre></div>
</div>
<p>You can access contract storage at any block level, just pass block id into the <code class="docutils literal notranslate"><span class="pre">using</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">block_id</span><span class="o">=</span><span class="s1">&#39;head~10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">storage</span><span class="p">()</span>
<span class="go"> {&#39;default_expiry&#39;: 300000,</span>
<span class="go">  &#39;ledger&#39;: -1,</span>
<span class="go">  &#39;metadata&#39;: -2,</span>
<span class="go">  &#39;minting_allowances&#39;: {&#39;tz1PNsHbJRejCnnYzbsQ1CR8wUdEQqVjWen1&#39;: 999989000000,</span>
<span class="go">   &#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;: 999985800000},</span>
<span class="go">  &#39;operators&#39;: -3,</span>
<span class="go">  &#39;paused&#39;: False,</span>
<span class="go">  &#39;permit_counter&#39;: 0,</span>
<span class="go">  &#39;permits&#39;: -4,</span>
<span class="go">  &#39;roles&#39;: {&#39;master_minter&#39;: &#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;,</span>
<span class="go">   &#39;owner&#39;: &#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;,</span>
<span class="go">   &#39;pauser&#39;: &#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;,</span>
<span class="go">   &#39;pending_owner&#39;: None},</span>
<span class="go">  &#39;total_supply&#39;: 20200000,</span>
<span class="go">  &#39;transferlist_contract&#39;: None}</span>
</pre></div>
</div>
<p>Under the hood PyTezos has parsed the storage type, collapsed all nested structures, converted annotations into keys,
and in the result we get a simple Python object which is much easier to manipulate.
You can also access child elements by name or index (depending on the underlying Michelson type).
In order to see type definition, just remove the trailing brackets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ledger&#39;</span><span class="p">]</span>
<span class="go"> &lt;pytezos.contract.data.ContractData object at 0x7f21aaeaca30&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB</span>
<span class="go"> .shell  # https://mainnet-tezos.giganode.io/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .path  # /ledger</span>

<span class="go"> Builtin</span>
<span class="go"> ()  # get as Python object</span>
<span class="go"> [key]  # access child elements by name or index</span>

<span class="go"> Typedef</span>
<span class="go"> $ledger:</span>
<span class="go">     { address: nat, … } || int /* Big_map ID */</span>

<span class="go"> $address:</span>
<span class="go">     str  /* Base58 encoded `tz` or `KT` address */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .dummy()</span>
<span class="go"> .encode()</span>
<span class="go"> .to_micheline()</span>
<span class="go"> .to_michelson()</span>
</pre></div>
</div>
</div>
<div class="section" id="bigmap-lookup">
<h2>BigMap lookup<a class="headerlink" href="#bigmap-lookup" title="Permalink to this headline">¶</a></h2>
<p>The approach described in the previous section also works for lazy storage, here’s how you can access Big_map values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">storage</span><span class="p">[</span><span class="s1">&#39;ledger&#39;</span><span class="p">][</span><span class="s1">&#39;tz1PNsHbJRejCnnYzbsQ1CR8wUdEQqVjWen1&#39;</span><span class="p">]()</span>
<span class="go">11000000</span>
</pre></div>
</div>
<p>Pretty cool, hah?</p>
</div>
<div class="section" id="view-method">
<h2>View method<a class="headerlink" href="#view-method" title="Permalink to this headline">¶</a></h2>
<p>In the previous example we queried a token balance for a particular owner.
We can do the same using special entrypoint <code class="docutils literal notranslate"><span class="pre">balance_of</span></code>. Let’s give a look at the interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">balance_of</span>
<span class="go"> &lt;pytezos.contract.entrypoint.ContractEntrypoint object at 0x7f4789170dc0&gt;</span>

<span class="go"> Properties</span>
<span class="go"> .key  # tz1Ne4yzDRQPd5HFz6sTaCYCNHwFubT2MWsB</span>
<span class="go"> .shell  # https://mainnet-tezos.giganode.io/ (mainnet)</span>
<span class="go"> .address  # KT1REEb5VxWRjcHm5GzDMwErMmNFftsE5Gpf</span>
<span class="go"> .block_id  # head</span>
<span class="go"> .entrypoint  # balance_of</span>

<span class="go"> Builtin</span>
<span class="go"> (*args, **kwargs)  # build transaction parameters (see typedef)</span>

<span class="go"> Typedef</span>
<span class="go"> $balance_of:</span>
<span class="go">     {</span>
<span class="go">       &quot;requests&quot;: [ $requests_item, … ],</span>
<span class="go">       &quot;callback&quot;: contract ($callback_param)</span>
<span class="go">     }</span>

<span class="go"> $callback_param:</span>
<span class="go">     list (pair (pair %request (address %owner) (nat %token_id)) (nat %balance))</span>

<span class="go"> $requests_item:</span>
<span class="go">     {</span>
<span class="go">       &quot;owner&quot;: address,</span>
<span class="go">       &quot;token_id&quot;: nat</span>
<span class="go">     }</span>

<span class="go"> $address:</span>
<span class="go">     str  /* Base58 encoded `tz` or `KT` address */</span>

<span class="go"> $nat:</span>
<span class="go">     int  /* Natural number */</span>


<span class="go"> Helpers</span>
<span class="go"> .decode()</span>
<span class="go"> .encode()</span>
</pre></div>
</div>
<p>Apparently, we need to pass a list of requests, where each item contains owner address and token ID.
In addition to that a callback address is expected which should accept the response (currently there are no on-chain views in Tezos, this async pattern is a workaround for them).
PyTezos allows you to keep that address empty and get the view result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">usds</span><span class="o">.</span><span class="n">balance_of</span><span class="p">(</span><span class="n">requests</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;tz1PNsHbJRejCnnYzbsQ1CR8wUdEQqVjWen1&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<span class="gp">... </span>  <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="s1">&#39;tz2QegZQXyz8b74iTdaqKsGRF7YQb88Wu9CS&#39;</span><span class="p">,</span> <span class="s1">&#39;token_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="go">...], callback=None).view()</span>
<span class="go">[{&#39;owner&#39;: &#39;tz1PNsHbJRejCnnYzbsQ1CR8wUdEQqVjWen1&#39;,</span>
<span class="go">  &#39;token_id&#39;: 0,</span>
<span class="go">  &#39;nat_2&#39;: 11000000},</span>
<span class="go"> {&#39;owner&#39;: &#39;tz1i2tE6hic2ASe9Kvy85ar5hGSSc58bYejT&#39;,</span>
<span class="go">  &#39;token_id&#39;: 0,</span>
<span class="go">  &#39;nat_2&#39;: 8200000},</span>
<span class="go"> {&#39;owner&#39;: &#39;tz2QegZQXyz8b74iTdaqKsGRF7YQb88Wu9CS&#39;, &#39;token_id&#39;: 0, &#39;nat_2&#39;: 0}]</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="integration_tests.html" class="btn btn-neutral float-right" title="Michelson integration tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="contents.html" class="btn btn-neutral float-left" title="Welcome to PyTezos reference!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Baking Bad.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>